<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <title>exhibition</title>

    <style type="text/css">
        .small-box {
            border-radius: 2px;
            position: relative;
            display: block;
            margin-bottom: 20px;
            box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
        }

        .small-box > .inner {
            padding: 10px;
        }

        .bg-aqua {
            background-color: #00c0ef !important;
        }

        .bg-green {
            background-color:#00a65a !important;
        }

        .bg-yellow {
            background-color:#f39c12 !important;
        }

        .bg-red {
            background-color:#dd4b39 !important;
        }
        
        .bg-maroon {
            background-color:#d81b60 !important;
        }

        .bg-purple {
            background-color:#605ca8 !important;
        }

        .bg-navy {
            background-color:#001f3f !important;
        }

        .bg-aqua, .bg-green, .bg-yellow, .bg-red, .bg-maroon, .bg-purple, .bg-navy {
            color: #fff !important;
        }

        .release-proportion {
            height: 400px;
        }
    </style>
  </head>
  <body>
      <div class="container mt-3">
          <div class="row">
              <div class="col-lg-6 col-xs-12">
                  <div class="small-box bg-purple">
                      <div class="inner">
                          <h3 id="totalDeclareCount">150</h3>
                          <p>总申报单量</p>
                      </div>
                  </div>
              </div>
              <div class="col-lg-6 col-xs-12">
                  <div class="small-box bg-maroon">
                      <div class="inner">
                          <h3 id="totalReleaseCount">250</h3>
                          <p>总放行单量</p>
                      </div>
                  </div>
              </div>
          </div>
          <div class="row">
              <div class="col-lg-3 col-xs-6">
                  <div class="small-box bg-green">
                      <div class="inner">
                          <h3 id="caiNiaoDeclareCount">150</h3>
                          <p>菜鸟申报单量</p>
                      </div>
                  </div>
              </div>
              <div class="col-lg-3 col-xs-6">
                  <div class="small-box bg-yellow">
                      <div class="inner">
                          <h3 id="caiNiaoReleaseCount">150</h3>
                          <p>菜鸟放行单量</p>
                      </div>
                  </div>
              </div>
              <div class="col-lg-3 col-xs-6">
                  <div class="small-box bg-aqua">
                      <div class="inner">
                          <h3 id="vipDeclareCount">150</h3>
                          <p>唯品会申报单量</p>
                      </div>
                  </div>
              </div>
              <div class="col-lg-3 col-xs-6">
                  <div class="small-box bg-red">
                      <div class="inner">
                          <h3 id="vipReleaseCount">150</h3>
                          <p>唯品会放行单量</p>
                      </div>
                  </div>
              </div>
          </div>
          <div class="row">
              <div class="col-lg-4 col-xs-12">
                  <div id="totalReleaseProportion" class="echars release-proportion"></div>
              </div>
              <div class="col-lg-4 col-xs-12">
                  <div id="caiNiaoReleaseProportion" class="echars release-proportion"></div>
              </div>
              <div class="col-lg-4 col-xs-12">
                  <div id="vipReleaseProportion" class="echars release-proportion"></div>
              </div>
          </div>
          <div class="row">
              <div class="col-lg-12 col-xs-12">
                  <h3>电商申报量放行排行前10</h3>
                  <table class="table">
                      <thead>
                          <tr>
                              <th scope="col">排名</th>
                              <th scope="col">电商</th>
                              <th scope="col">总量</th>
                              <th scope="col">放行</th>
                              <th scope="col">放行率</th>
                              <th scope="col">内放行</th>
                              <th scope="col">内放行率</th>
                              <th scope="col">申报中</th>
                              <th scope="col">发送成功</th>
                              <th scope="col">重推</th>
                              <th scope="col">退单</th>
                          </tr>
                      </thead>
                      <tbody id="ranking">
                          <tr>
                              <td>1</td>
                              <td>Otto</td>
                              <td>@mdo</td>
                              <td>@mdo</td>
                              <td>@mdo</td>
                              <td>@mdo</td>
                              <td>@mdo</td>
                              <td>@mdo</td>
                              <td>@mdo</td>
                              <td>@mdo</td>
                              <td>@mdo</td>
                          </tr>
                          <tr>
                              <td>2</td>
                              <td>Jacob</td>
                              <td>Thornton</td>
                              <td>@mdo</td>
                              <td>@mdo</td>
                              <td>@mdo</td>
                              <td>@mdo</td>
                              <td>@mdo</td>
                              <td>@mdo</td>
                              <td>@mdo</td>
                              <td>@mdo</td>
                          </tr>
                      </tbody>
                      <tfoot>
                          <tr>
                              <th scope="col">排名</th>
                              <th scope="col">电商</th>
                              <th scope="col">总量</th>
                              <th scope="col">放行</th>
                              <th scope="col">放行率</th>
                              <th scope="col">内放行</th>
                              <th scope="col">内放行率</th>
                              <th scope="col">申报中</th>
                              <th scope="col">发送成功</th>
                              <th scope="col">重推</th>
                              <th scope="col">退单</th>
                          </tr>
                      </tfoot>
                  </table>
              </div>
              <div class="col-lg-6 col-xs-12">
              </div>
          </div>
      </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/4.2.1/echarts.min.js"></script>
    <script>
        var totalReleaseProportionChar = echarts.init(document.getElementById('totalReleaseProportion'));
        var caiNiaoReleaseProportionChar = echarts.init(document.getElementById('caiNiaoReleaseProportion'));
        var vipReleaseProportionChar = echarts.init(document.getElementById('vipReleaseProportion'));

        totalOption = {
            tooltip : {
                formatter: "{a} <br/>{b} : {c}%"
            },
            toolbox: {
                feature: {
                    restore: {},
                    saveAsImage: {}
                }
            },
            series: [
                {
                    name: '总放行率',
                    type: 'gauge',
                    detail: {formatter:'{value}%'},
                    data: [{value: 0, name: '总放行率'}]
                }
            ]
        };

        caiNiaoOption = {
            tooltip : {
                formatter: "{a} <br/>{b} : {c}%"
            },
            toolbox: {
                feature: {
                    restore: {},
                    saveAsImage: {}
                }
            },
            series: [
                {
                    name: '菜鸟放行率',
                    type: 'gauge',
                    detail: {formatter:'{value}%'},
                    data: [{value: 0, name: '菜鸟放行率'}]
                }
            ]
        };

        vipOption = {
            tooltip : {
                formatter: "{a} <br/>{b} : {c}%"
            },
            toolbox: {
                feature: {
                    restore: {},
                    saveAsImage: {}
                }
            },
            series: [
                {
                    name: '唯品会放行率',
                    type: 'gauge',
                    detail: {formatter:'{value}%'},
                    data: [{value: 0, name: '唯品会放行率'}]
                }
            ]
        };

        function openWebSocket(onMessage) {
            var wsServer = 'ws://' + location.host + '/maintain/exhibition/ws/exhibition';
            var websocket = new WebSocket(wsServer);

            websocket.onopen = function() {
                console.info("websocket connect open");
            };

            websocket.onmessage = function(ev) {
                console.info("recv msg data: " + ev.data);
                onMessage(ev.data);
            };

            websocket.onclose = function(ev) {
                console.info("websocket close");
            };
        }

        openWebSocket(function(message) {
            console.info("message: " + message);
            messageJson = JSON.parse(message);
            var totalDeclareCount = messageJson["totalDeclareCount"];
            var totalReleaseCount = messageJson["totalReleaseCount"];
            var caiNiaoDeclareCount = messageJson["caiNiaoDeclareCount"];
            var caiNiaoReleaseCount = messageJson["caiNiaoReleaseCount"];
            var vipDeclareCount = messageJson["vipDeclareCount"];
            var vipReleaseCount = messageJson["vipReleaseCount"];
            $('#totalDeclareCount').text(totalDeclareCount);
            $('#totalReleaseCount').text(totalReleaseCount);
            $('#caiNiaoDeclareCount').text(caiNiaoDeclareCount + " " + (caiNiaoDeclareCount / totalDeclareCount * 100).toFixed(2) + "%");
            $('#caiNiaoReleaseCount').text(caiNiaoReleaseCount + " " + (caiNiaoReleaseCount / totalReleaseCount * 100).toFixed(2) + "%");
            $('#vipDeclareCount').text(vipDeclareCount + " " + (vipDeclareCount / totalDeclareCount * 100).toFixed(2) + "%");
            $('#vipReleaseCount').text(vipReleaseCount + " " + (vipReleaseCount / totalReleaseCount * 100).toFixed(2) + "%");
            totalOption.series[0].data[0].value = (totalReleaseCount / totalDeclareCount * 100).toFixed(2);
            caiNiaoOption.series[0].data[0].value = (caiNiaoReleaseCount / caiNiaoDeclareCount * 100).toFixed(2);
            vipOption.series[0].data[0].value = (vipReleaseCount / vipDeclareCount * 100).toFixed(2);

            totalReleaseProportionChar.setOption(totalOption, true);
            caiNiaoReleaseProportionChar.setOption(caiNiaoOption, true);
            vipReleaseProportionChar.setOption(vipOption, true);
            ranking = messageJson["ranking"];
            trstr = "";
            for (i in ranking) {
                rdata = ranking[i];
                trstr += "<tr>";
                trstr += "<td>" + (Number(i) + 1) + "</td>";
                trstr += "<td>" + rdata[0] + "</td>";
                trstr += "<td>" + rdata[1] + "</td>";
                trstr += "<td>" + rdata[2] + "</td>";
                trstr += "<td>" + (rdata[2] / rdata[1] * 100).toFixed(4) + "%</td>";
                trstr += "<td>" + rdata[3] + "</td>";
                trstr += "<td>" + (rdata[3] / rdata[1] * 100).toFixed(4) + "%</td>";
                trstr += "<td>" + rdata[4] + "</td>";
                trstr += "<td>" + rdata[5] + "</td>";
                trstr += "<td>" + rdata[6] + "</td>";
                trstr += "<td>" + rdata[7] + "</td>";
                trstr += "</tr>";
            }
            $("#ranking").html(trstr);
        });


        totalReleaseProportionChar.setOption(totalOption);
        caiNiaoReleaseProportionChar.setOption(caiNiaoOption);
        vipReleaseProportionChar.setOption(vipOption);
    </script>
  </body>
</html>
